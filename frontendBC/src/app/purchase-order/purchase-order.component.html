<main>
  <!-- Button to open the modal for creating a new purchase order -->
  <button class="btn2" (click)="toggleCreateModal()">Créer une commande</button>
  <br><br><br>

  <!-- Purchase Orders Table -->
  <div *ngIf="!selectedOrder">
    <div class="purchase-order-table-container">
      <table>
        <thead>
          <tr>
        <th>N° commande</th>
            <th>Fournisseur</th>
            <th>Articles</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let order of purchaseOrders">
            <td>{{ order.orderId }}</td>
            <td>{{ order.fournisseurName }}</td>
            <td>{{ order.articles | articleListStringPipe}}</td>
            <td>{{ order.date | date: 'mediumDate' }}</td>
            <td>
              <button (click)="generateBonDeCommande(order)" class="icon-button">
                <i class="fas fa-file-alt"></i>
              </button>
              <button (click)="deleteOrder(order.orderId)" class="icon-button">
                <i class="fas fa-trash"></i>
              </button>

            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Generated Bon de Commande -->
  <div *ngIf="selectedOrder">
    <app-bon-de-commande [order]="selectedOrder"></app-bon-de-commande>
    <button (click)="closeBonDeCommande()">Fermer</button>
  </div>

  <!-- Modal for Creating a New Purchase Order -->
  <div id="createPurchaseOrderModal" class="modal" [class.show]="showCreateModal">
    <div class="rectangle" style="overflow-y: scroll;">
      <span class="close" (click)="closeModal()">&times;</span>
      <form [formGroup]="newPurchaseOrderForm" (ngSubmit)="submitPurchaseOrder()">
        <h2 style="text-align: center;">Créer une commande</h2>
        <label for="fournisseurId">Fournisseur:</label>
        <select id="fournisseurId" formControlName="fournisseurId" required>
          <option *ngFor="let fournisseur of fournisseurs" [value]="fournisseur.nom">{{ fournisseur.nom }}</option>
        </select>

        <div class="articles-selection">
          <h3>Choisissez les Articles:</h3>
          <div *ngFor="let article of articles" (click)="toggleArticleSelection(article.nomArticle)"
            [class.selected]="isSelected(article.nomArticle)">
            <span>{{ article.nomArticle }}</span>
          </div>
        </div>

        <div formArrayName="articles">
          <div *ngFor="let article of articlesFormArray.controls; let i = index" [formGroupName]="i">
            <label for="article{{i}}">Article:</label>
            <input type="text" id="article{{i}}" formControlName="nom" readonly>
            <label for="quantite{{i}}">Quantité:</label>
            <input id="quantite{{i}}" type="number" formControlName="quantite" required>
            <button type="button" (click)="removeArticle(i)">Supprimer</button>
          </div>
        <br>
        <br>
  
        </div>

        <button type="submit">Créer</button>
      </form>
    </div>
  </div>
</main>


<style>
  .articles-selection div {
    cursor: pointer;
    padding: 5px;
    margin: 5px;
    border: 1px solid #ccc;
  }

  .articles-selection div.selected {
    background-color: #d1ecf1;
    border-color: #bee5eb;
  }

  .modal.show {
    display: block;
  }

  .modal .rectangle {
    position: relative; /* Changed to relative for easier inner positioning */
    margin: 20px auto; /* Center the form on the page */
    height: 604px;
    width: 587px;
    border-radius: 50px;
    border: 2.02px solid black;    
    background-color: #EBEBEB;
    padding: 20px; /* Padding inside the rectangle */
  }

  .modal .close {
    position: absolute;
    top: 10px;
    right: 10px;
    cursor: pointer;
  }

  .purchase-order-table-container {
    max-width: 100%;
    overflow-x: auto;
  }


</style>
